[supervisord]
nodaemon=true
logfile=/app/logs/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
pidfile=/tmp/supervisord.pid

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
autostart=true
autorestart=true
stdout_logfile=/app/logs/nginx_stdout.log
stderr_logfile=/app/logs/nginx_stderr.log
priority=900

[program:backend]
command=/bin/bash -c "/app/wait-for-postgres.sh db 5432 && cd /app/backend && python -m uvicorn app.main:app --host 0.0.0.0 --port 8001"
directory=/app/backend
autostart=true
autorestart=true
stdout_logfile=/app/logs/backend_stdout.log
stderr_logfile=/app/logs/backend_stderr.log
priority=100

[program:ollama]
command=ollama serve
autostart=true
autorestart=true
stdout_logfile=/app/logs/ollama_stdout.log
stderr_logfile=/app/logs/ollama_stderr.log
priority=200
